# 工单

## 总结

### 检测报告

- 从检测记录进入
- 上半区: 检测报告 <!-- ✔ -->
  - 包括多个检测项, 对于不合格的检测项提供维修建议, 右上角可"分享" <!-- ✔ -->
- 下半区: 推荐工单  <!-- ✔ -->
  - 包括多项维修建议 <!-- ✔ -->
          - 类型1 项目名称、各子项内容、各子项价格、项目总价 <!-- ✔ -->
          - 类型2 项目名称、项目内容、项目价格 <!-- ✔ -->
  - 计算工单总价 <!-- ✔ -->
- 底部: "需要"/"不需要" <!-- ✔ -->
        - 点击需要, 跳转到工单详情(进行中), 生成的工单状态为"进行中", 工单id绑定到报告id <!-- ✔ -->
        - 点击不需要, 跳转到其他页面, 生成的工单状态为"已关闭", 工单id绑定到报告id <!-- ✔ -->

### 我的工单

- 从首页进入 <!-- ✔ -->
- 右上角"创建工单" <!-- ✔ -->
- 结构为选项卡列表, 每个选项卡对应一个工单 <!-- ✔ -->
- 按工单创建时间的逆序排序 <!-- ✔ -->
- 每个选项卡的右上角按不同颜色标识工单状态(进行中-黄色/已完成-绿色/已关闭-灰色) <!-- ✔ -->

### 工单详情(进行中)

- 从"检测报告-需要"进入 (工单已绑定报告)<!-- ✔ -->
- 从"我的工单-进行中的工单"进入 (工单可能已绑定也可能未绑定报告)<!-- ✔ -->
- 从"我的工单-创建工单"进入 (工单未绑定报告)<!-- ✔ -->
  
- 需要提供缓存机制 (意外退出后重进能恢复页面)<!-- ✔ -->
- 上半区:
  - 客户及车辆信息(导入/填写)<!-- ✔ -->
  - 右上角"查看报告" (判断工单id是否存在绑定的报告id, 存在才能查看)<!-- ✔ -->
- 下半区:
  - 维保项目 (可编辑)
    - 如果是从检测报告进入, 导入该工单对应的所有建议项 <!-- ✔ -->
    - 项目每次有价格变动都重新计算并显示项目总价 <!-- ✔ -->
  - 推荐项目
    - 点击推荐项目名称, 追加到列表, 填充默认值 <!-- ✔ -->
    - 点击"自定义", 追加到列表, 手动编辑 <!-- ✔ -->
    - 点击指定项目的"X", 移除该项目 <!-- ✔ -->
  - "收款"<!-- ✔ -->
    - 点击后更新编辑的数据, 收款状态更新为true (默认为false), 工单状态更新为"已关闭"<!-- ✔ -->
  - "保存"<!-- ✔ -->
    - 点击后更新编辑的数据, 工单状态不变<!-- ✔ -->
  - "完成"<!-- ✔ -->
    - 点击后弹窗"工单总价为xxx元,  是否已付款?"<!-- ✔ -->
      - 是: 更新编辑的数据, 收款状态更新为true, 工单状态更新为"已完成"<!-- ✔ -->
      - 否: 更新编辑的数据, 收款状态不变(默认为false), 工单状态更新为"已完成"<!-- ✔ -->
  - "作废"<!-- ✔ -->
    - 回到其他页面, 数据库回滚<!-- ✔ -->

### 工单详情(已完成)

- 从我的工单-点击已完成工单进入<!-- ✔ -->
- 上半区:
  - 客户及车辆信息(导入)<!-- ✔ -->
  - 右上角"查看报告" (判断工单id是否存在绑定的报告id, 存在才能查看)<!-- ✔ -->
- 下半区:
  - 维保项目 (不可编辑)<!-- ✔ -->
    - 显示所有维修项数据, 计算总价<!-- ✔ -->
  - "收款"
    - 点击后更新收款状态, 工单状态更新为"已关闭"<!-- ✔ -->
  - "激活"
    - 点击后工单状态更新为"进行中"<!-- ✔ -->

### 工单详情(已关闭)

- 从我的工单-点击已关闭工单进入 <!-- ✔ -->
- 上半区: <!-- ✔ -->
  - 客户及车辆信息(导入) <!-- ✔ -->
  - 右上角"查看报告" (判断工单id是否存在绑定的报告id, 存在才能查看) <!-- ✔ -->
- 下半区:<!-- ✔ -->
  - 维保项目 (不可编辑)<!-- ✔ -->
    - 显示所有维修项数据, 计算总价<!-- ✔ -->
  - 显示收款状态(已付款/未付款)<!-- ✔ -->

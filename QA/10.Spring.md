# Spring 常见面试题

## Note

- 概念类问题可加入个人理解
- 有的问题并不会问这么深
- 不理解的答案借助 Demo 理解

### Spring 基础

- **什么是 Spring 框架**
  - Spring是一个开源Java框架，旨在简化企业级应用开发。通过提供全面的编程和配置模型，Spring允许无缝集成多种企业服务。它通过依赖注入和面向切面编程，实现了业务对象和服务的松耦合，使得开发更加灵活。

- **什么是约定大于配置?**

### Spring IoC

- **谈谈自己对于 Spring IoC 的了解**
  - IoC（控制反转）是一种将控制权从程序代码转移到外部容器的设计原则。在Spring框架中，IoC容器负责创建、管理和配置Bean，从而实现了依赖注入，即组件间的依赖关系不再由组件本身在代码内部设置，而是由容器在运行时动态注入。

- **什么是 Spring Bean？**
  - 在Spring框架中，Bean是构成应用程序的基本单位，代表了Spring IoC容器管理的对象。这些Bean通常是项目中的服务层、数据访问层或业务逻辑对象，并且它们的生命周期由Spring IoC容器管理。

- **Bean 的生命周期?**
  1. 实例化：想象你有一颗种子，这就像是Spring框架中的Bean定义。当Spring容器（花园管理员）决定创建一个Bean（种植这颗种子）时，它首先实例化这个Bean，就好比种子开始发芽。
  2. 依赖注入：种子发芽后，需要土壤、水和阳光。在Bean的生命周期中，这对应于填充属性或依赖。Spring容器会提供所需的所有依赖（比如数据源、服务等），就像花园管理员给植物浇水和施肥。
  3. 初始化：当植物成长到一定阶段，你可能会修剪它，让它更健康地成长。在Spring中，一旦所有的属性都被设置好，Bean会经过初始化阶段。这里，你可以定义一些定制的行为，比如设置一些默认值或启动一个内部的计时器。
  4. 使用中：植物继续成长，直到成熟。在应用运行期间，Bean处于可用状态，就像成熟的植物一样，可以为环境（即你的应用程序）提供所需的功能和服务。
  5. 销毁：最终，植物会衰老并死亡。同样地，当Spring容器关闭时，Bean的生命周期也会结束。在这个阶段，你可以定义一些清理工作，比如关闭数据库连接或释放资源，就像花园管理员清理枯萎的植物

- **Bean 的作用域有哪些?**
  1. 单例（Singleton）：想象你的家里只有一台电视机。无论家中哪个房间的人想看电视，都只能看这台电视机。在Spring中，单例作用域意味着整个容器中只创建一个Bean实例。这个实例被所有请求共享，就像家里的电视机被所有家庭成员共用。
  2. 原型（Prototype）：想象你有一个水果切片机，每次你需要切水果时，你都会新拿一个切片机。在Spring中，原型作用域意味着每次请求都会创建一个新的Bean实例，就像每次需要切水果时都使用一个新的切片机。
  3. 请求（Request）：这个作用域可以类比为咖啡厅里的一次性纸杯。每位顾客点餐时都会得到一个新的纸杯。在Spring的Web应用中，请求作用域意味着每个HTTP请求都会创建一个新的Bean实例，就像每个顾客得到自己的纸杯。
  4. 会话（Session）：将其想象为咖啡厅的会员卡。在整个会话期间，这张卡是顾客的唯一标识。在Spring Web应用中，会话作用域意味着每个用户会话都会创建一个新的Bean实例，就像每个顾客有自己的会员卡。
  5. 全局会话（Global Session）：这个作用域可以比作一家连锁咖啡店的通用会员卡，无论你去哪个分店，都可以使用。在Spring中，全局会话作用域通常用于Portlet环境，这意味着Bean实例在全局Portlet会话中是共享的。

- **Bean 是线程安全的吗？**
  1. 单例 Bean：想象一家餐厅只有一位厨师（Bean实例）。无论有多少顾客（线程）同时来到餐厅，厨师需要为所有人服务。如果厨师的工作方式不是线程安全的（比如，同时处理多个订单时容易混淆），那么就可能出现问题，比如错发菜品或者服务延迟。在Spring中，单例Bean默认不是线程安全的，因为同一个实例被多个线程共享。开发者需要确保单例Bean的线程安全性，例如通过同步方法或使用线程安全的对象。
  2. 原型 Bean：现在想象餐厅采用了不同的策略，每个顾客进来时都分配一个专属厨师（每个线程都获得一个新的Bean实例）。这样，每位厨师只需专注于为一个顾客服务，不会被其他顾客打扰。在这种情况下，即使厨师的工作方式本身不是线程安全的，也不会影响到其他顾客。在Spring中，原型Bean为每个请求创建一个新的实例，因此线程安全问题较少。
  3. 请求和会话 Bean：这相当于餐厅对于特定顾客（或一组顾客）提供专门的服务。例如，请求作用域Bean就像是为每个顾客单独准备的餐点，只在这个顾客的访问期间有效；会话作用域Bean则像是提供给特定顾客群体的服务，这些服务在顾客的整个会话期间都是有效的。这些Bean通常是线程安全的，因为它们仅在特定的上下文中被访问。

- **Spring 如何解决 Bean 的循环依赖问题**
  - 循环依赖指的是两个或多个Bean相互依赖，导致无法顺序创建。Spring通过三级缓存解决这一问题。
    - 第一级缓存存储完全初始化好的Bean；
    - 第二级缓存存储早期的Bean引用，允许注入其他Bean的引用；
    - 第三级缓存存储Bean工厂对象，用于生成Bean的早期引用。
  - 当创建 A 时，如果存在循环依赖，Spring会先将一个不完全初始化的 A（早期引用）放入二级缓存。
  - 如果 B 依赖于 A，它可以从二级缓存中获取这个早期引用来满足依赖，
  - 再将完整的 B 的引用注入到 A 的二级缓存来创建完整的 A
  - 完整的 A 在创建完成后会被移至一级缓存, 从而解决循环依赖的问题。

- **实际工作中哪些情况可能会导致获取不到Bean，怎么解决？**
  - 情况可能包括：Bean未定义或未被Spring容器管理、Bean的作用域不正确、Bean的依赖注入失败、配置错误或类路径问题。
  - 解决方法：
    - 确保Bean已在Spring配置中正确定义。
    - 检查Bean的作用域是否适合使用场景。
    - 确保所有依赖项都可用且没有循环依赖。
    - 检查是否存在配置错误或类路径问题，如注解配置未被正确扫描。
    - 使用Spring的调试日志来诊断问题。

### Spring AoP

- **什么是AOP（面向切面编程）？**
  1. 电影制作（应用程序开发）：想象你正在制作一部电影，这部电影有主线故事（你的核心业务逻辑）。在电影中，除了主线故事，通常还会有一些重复出现的元素，比如特定的背景音乐、特效或场景切换（横跨多个部分的通用功能，如日志记录、事务管理、安全检查等）。
  2. 添加特效和背景音乐（横切关注点）：在电影中，你不会在每个场景手动添加背景音乐或特效，而是会在后期制作中加入。这些元素虽然重要，但并不是主线故事的一部分，它们是横跨整部电影的“横切关注点”。
  - 面向切面编程（AOP）：在Spring中，AOP允许你以类似的方式处理应用程序的横切关注点。你不需要在每个方法或类中手动编写日志记录或安全检查代码。相反，你定义“切面”（类似于电影中的后期特效团队），这些切面独立于你的主业务逻辑，并且可以在运行时应用于程序的不同部分。
  - 切入点和通知（选择何处添加特效）：在AOP中，你定义“切入点”（决定在电影的哪些场景中加入特效），以及“通知”（具体的特效内容）。这样，当特定部分的代码执行时（比如，一个方法开始或结束），Spring框架会自动应用相应的通知（比如，添加日志或执行安全检查）。

- **AOP 的通知类型?**
  - 前置通知（Before Advice）：这种通知在目标方法执行之前执行。它用于在方法实际执行前进行某些操作，如安全检查、日志记录等。
  - 后置通知（After Returning Advice）：这种通知在目标方法成功执行之后执行，即没有抛出异常的情况下。它通常用于处理方法返回的结果，例如修改返回值或进行某些后处理操作。
  - 环绕通知（Around Advice）：环绕通知可以在方法执行之前和之后执行，并且有能力控制方法的执行。这是最强大的通知类型，可以用于执行前置和后置通知的工作，还能决定是否继续执行目标方法或提前返回。
  - 异常通知（After Throwing Advice）：这种通知在方法抛出异常后执行。它用于处理异常，如记录日志、通知其他系统或执行回滚操作。
  - 最终通知（After (finally) Advice）：无论目标方法是否成功执行，这种通知都会执行。它类似于Java中的finally块，通常用于释放资源或进行清理工作。

### Spring MVC

- **说说自己对于 Spring MVC 了解?**
  - Spring MVC是Spring的一部分，用于构建Web应用程序。它是一个基于模型-视图-控制器（MVC）架构的Web框架，通过将请求映射到处理器，与模型交互，再渲染视图，实现了Web应用的流程控制。

- **Spring MVC 的核心组件有哪些？**
  - 核心组件包括DispatcherServlet（前端控制器）、Controller（处理器）、ViewResolver（视图解析器）和ModelAndView（模型和视图容器）。

- **SpringMVC 工作原理了解吗?**
  - 当一个请求到达DispatcherServlet时，它根据配置（如注解或XML）决定哪个Controller处理这个请求。Controller处理完请求后，返回ModelAndView对象。然后，ViewResolver根据视图名解析出具体的View。最后，DispatcherServlet渲染视图并返回响应。

- **统一异常处理怎么做？**
  - 可以使用@ControllerAdvice注解来定义一个全局异常处理器。结合@ExceptionHandler注解，可以定义对特定异常的处理方法，用于统一处理Controller抛出的异常。

### Spring 事务

- **Spring 管理事务的方式有几种？**
  - Spring提供了两种事务管理方式：编程式和声明式。编程式需要在代码中显式管理事务，而声明式则通过@Transactional注解来声明事务边界和属性。

- **Spring 事务中哪几种事务传播行为?**

  - 如果当前存在事务，则加入该事务
    1. REQUIRED（默认）：如果当前没有事务，则创建一个新的事务。这是最常用的传播行为。
    2. SUPPORTS：如果当前没有事务，则以非事务的方式执行。
    3. MANDATORY：如果当前没有事务，则抛出异常。

  - 如果当前存在事务，则暂停该事务
    4. REQUIRES_NEW：总是创建一个新的事务
    5. NOT_SUPPORTED：总是以非事务方式执行

  - 如果当前存在事务，则抛出异常
    6. NEVER：总是以非事务方式执行

  - 如果当前存在事务，则在嵌套事务内执行
    7. NESTED：如果当前没有事务，则创建一个新的事务。嵌套事务是一种特殊的事务，它是一个主事务内部的子事务，可以独立于主事务进行提交或回滚。(主回滚子亦回滚, 子回滚主不回滚)

### Spring Security

- **概述 Spring Security 的鉴权流程**
  - 用户请求访问受保护的资源。
  - 拦截请求, 身份验证
  - 未认证用户重定向到登录页面
  - 用户提交登录凭据
  - 验证用户
  - 验证成功, 存储身份信息
  - 对于后续请求, 检查身份信息来确认用户认证状态和权限
  - 根据用户权限决定是否允许访问请求的资源

  <!-- - 用户请求访问受保护的资源。
  - 请求被Security Filter Chain拦截，用于处理身份验证和授权。
  - 如果用户未认证，请求被重定向到登录页面。
  - 用户提交登录凭据（如用户名和密码）。
  - AuthenticationManager尝试通过AuthenticationProvider验证用户。
  - 成功验证后，用户的身份和权限信息被存储在SecurityContext中。
  - 对于后续请求，Spring Security检查SecurityContext来确认用户的认证状态和权限。
  - 访问决策管理器（AccessDecisionManager）根据用户权限决定是否允许访问请求的资源。 -->
